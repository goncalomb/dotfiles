#!/bin/bash

echo "Starting SOCKS tunnel..."
# https://www.g-loaded.eu/2006/11/24/auto-closing-ssh-tunnels/
ssh -D 8100 -Cnf "$1" sleep 2 || exit

mkdir "/tmp/chrome-socks"
touch "/tmp/chrome-socks/First Run"

echo "Starting Google Chrome..."
google-chrome --user-data-dir="/tmp/chrome-socks" --proxy-server="socks5://localhost:8100" --disable-extensions --disable-translate --incognito http://ip-api.com/line/?fields=12809 2> /dev/null
rm -rf "/tmp/chrome-socks"
